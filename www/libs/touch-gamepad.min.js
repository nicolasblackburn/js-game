!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.touchGamepad=e():t.touchGamepad=e()}(self,function(){return(()=>{"use strict";var o={"./src/TouchGamepad.ts":function(t,e,o){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TouchGamepad=void 0;var s=o("./src/private/EventEmitter.ts"),i=o("./src/TouchSurface.ts"),n=o("./src/TouchRegion.ts"),c={axisDistance:64,dualHands:!0,virtualDPad:!1};function a(t,e,o,s){return{x:t,y:e,width:o,height:s}}function h(t,e){return{x:t*e.x,y:t*e.y}}var d=Math.PI*Math.PI;u.prototype.on=function(t,e,o){this.emitter.on(t,e,o)},u.prototype.off=function(t,e){this.emitter.off(t,e)},o=u;function u(t){var u=this;void 0===t&&(t={}),this.axes=[0,0],this.buttons=[{value:0,pressed:!1}];var e=r(r({},c),t),o=e.axisDistance,t=e.dualHands,e=e.virtualDPad;this.config={axisDistance:o,dualHands:t,virtualDPad:e},this.emitter=new s.EventEmitter,this.config.dualHands=!1;e=new i.TouchSurface({delayTouchStart:!this.config.dualHands,tapTimeThresold:this.config.dualHands?0:100,touchStartDistanceThresold:this.config.dualHands?0:7});this.regionRectangles=[a(0,0,1,1),a(0,0,.5,1),a(.5,0,1,1)],this.touchRegion=new n.TouchRegion({touchInput:e,region:this.config.dualHands?this.regionRectangles[1]:this.regionRectangles[0]}),this.secondaryTouchRegion=new n.TouchRegion({touchInput:e,region:this.regionRectangles[2]}),this.touchRegion.on("touchmove",function(t){var e,o,s=t.from,i=t.to,n=(o=s,{x:(e=i).x-o.x,y:e.y-o.y});0===n.x&&0===n.y?(u.axes[0]=0,u.axes[1]=0):(t=n,s=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.min(u.config.axisDistance,s)/u.config.axisDistance,n=u.config.virtualDPad?(e=2*Math.PI*(e=8,t=(o=n).x,o=o.y,(Math.atan2(o,t)/d*e+e+.5)%e|0)/8,h(i,{x:Math.cos(e),y:Math.sin(e)})):h(i/s,n),u.axes[0]=n.x,u.axes[1]=n.y),!u.config.dualHands&&u.buttons[0].pressed&&(u.buttons[0].value=0,u.buttons[0].pressed=!1,u.emitter.emit("buttonup",r({type:"buttonup",index:0},u.buttons[0]))),u.emitter.emit("axispressed",{type:"axispressed",x:u.axes[0],y:u.axes[1],indexes:[0,1]})}),this.touchRegion.on("touchend",function(){u.axes[0]=0,u.axes[1]=0,u.emitter.emit("axisreleased",{type:"axisreleased",x:u.axes[0],y:u.axes[1],indexes:[0,1]})}),this.touchRegion.on("touchendoutside",function(){u.axes[0]=0,u.axes[1]=0,u.emitter.emit("axisreleased",{type:"axisreleased",x:u.axes[0],y:u.axes[1],indexes:[0,1]})}),this.touchRegion.on("tappressed",function(){u.config.dualHands||(u.buttons[0].value=1,u.buttons[0].pressed=!0,u.emitter.emit("buttonpressed",r({type:"buttonpressed",index:0},u.buttons[0])))}),this.touchRegion.on("tapreleased",function(){u.config.dualHands||(u.buttons[0].value=0,u.buttons[0].pressed=!1,u.emitter.emit("buttonreleased",r({type:"buttonreleased",index:0},u.buttons[0])))}),this.secondaryTouchRegion.on("touchstart",function(){u.config.dualHands&&(u.buttons[0].value=1,u.buttons[0].pressed=!0,u.emitter.emit("buttonpressed",r({type:"buttonpressed",index:0},u.buttons[0])))}),this.secondaryTouchRegion.on("touchend",function(){u.config.dualHands&&(u.buttons[0].value=0,u.buttons[0].pressed=!1,u.emitter.emit("buttonreleased",r({type:"buttonreleased",index:0},u.buttons[0])))})}e.TouchGamepad=o},"./src/TouchRegion.ts":function(t,e,o){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TouchRegion=void 0;var u=o("./src/private/EventEmitter.ts");function r(t,e){return e.x*window.innerWidth<=t.x&&t.x<=(e.x+e.width)*window.innerWidth&&e.y*window.innerHeight<=t.y&&t.y<=(e.y+e.height)*window.innerHeight}s.prototype.on=function(t,e,o){this.emitter.on(t,e,o)},s.prototype.off=function(t,e){this.emitter.off(t,e)},o=s;function s(t){var e,o=this,s=t.touchInput,t=t.region;this.emitter=new u.EventEmitter,this.touchInput=s,this.region=t;var i={tappressed:function(t){"tappressed"===t.type&&r(t.touch,o.region)&&(o.touchInput.on("tapreleased",i.tapreleased),o.emitter.emit(t.type,{type:t.type,from:t.touch}))},tapreleased:function(t){"tapreleased"===t.type&&r(t.touch,o.region)&&(o.touchInput.off("tapreleased"),o.emitter.emit(t.type,{type:t.type,from:t.touch}))},touchstart:function(t){"touchstart"===t.type&&r(t.touch,o.region)&&!e&&(e=n({},t.touch),o.touchInput.on("touchmove",i.touchmove),o.touchInput.on("touchend",i.touchend),o.touchInput.on("touchendoutside",i.touchendoutside),o.emitter.emit(t.type,{type:t.type,from:t.touch}))},touchmove:function(t){"touchmove"===t.type&&e&&t.touch.id===e.id&&o.emitter.emit(t.type,{type:t.type,from:e,to:t.touch})},touchend:function(t){"touchend"===t.type&&e&&t.touch.id===e.id&&(e=void 0,o.touchInput.off("touchmove",i.touchmove),o.touchInput.off("touchend",i.touchend),o.touchInput.off("touchendoutside",i.touchendoutside),o.emitter.emit(t.type,{type:t.type,from:e,to:t.touch}))},touchendoutside:function(t){"touchendoutside"===t.type&&e&&t.touch.id===e.id&&(e=void 0,o.touchInput.off("touchmove",i.touchmove),o.touchInput.off("touchend",i.touchend),o.touchInput.off("touchendoutside",i.touchendoutside),o.emitter.emit(t.type,{type:t.type,from:e,to:t.touch}))}};this.touchInput.on("touchstart",i.touchstart),this.touchInput.on("tappressed",i.tappressed)}e.TouchRegion=o},"./src/TouchState.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TouchState=void 0;function o(t,e,o){this.id=t,this.x=e,this.y=o,this.startX=e,this.startY=o,this.pressed=!1,this.started=!1,this.startTime=performance.now()}e.TouchState=o},"./src/TouchSurface.ts":(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TouchSurface=void 0;var a=o("./src/private/DefaultTicker.ts"),h=o("./src/private/EventEmitter.ts"),d=o("./src/TouchState.ts");function p(r,t){t=t.reduce(function(t,e){var o=t[0],s=t[1],i=e.x,n=e.y,u=e.id,t=e.started,e=e.pressed,i=r.x-i,n=r.y-n,n=Math.sqrt(i*i+n*n);return n<s?[{x:r.x,y:r.y,id:u,started:t,pressed:e},n]:[o,s]},[{x:0,y:0,id:-1,started:!1,pressed:!1},Number.POSITIVE_INFINITY])[0];if(0<=t.id)return t}s.prototype.on=function(t,e,o){this.emitter.on(t,e,o)},s.prototype.off=function(t,e){this.emitter.off(t,e)},s.prototype.emit=function(t,e){this.emitter.emit(t,e)},o=s;function s(t){var u=this;this.touches=[];var e=t.ticker,o=t.delayTouchStart,s=t.touchStartDistanceThresold,t=t.tapTimeThresold;this.ticker=e||new a.DefaultTicker,this.emitter=new h.EventEmitter,this.distanceThreshold=s,this.timeThreshold=t,this.delayTouchStart=o;for(var o={update:function(){},pointerdown:function(t){u.touches.sort(function(t,e){return e.id-t.id});for(var e=0,o=0;o<u.touches.length&&e>=u.touches[o].id;)e=u.touches[o].id+1,o++;var s,i=new d.TouchState(e,t.x,t.y);u.touches.push(i),u.delayTouchStart?(s=function(){performance.now()-i.startTime>=u.timeThreshold&&(u.ticker.remove(s),i.started||i.pressed||(i.pressed=!0,u.emit("tappressed",{type:"tappressed",touches:u.touches,touch:i})))},u.ticker.add(s)):(i.started=!0,u.emit("touchstart",{type:"touchstart",touches:u.touches,touch:i}))},pointermove:function(t){var e,o,s=p(t,u.touches),i=u.distanceThreshold*u.distanceThreshold;if(s){for(var n=0;n<u.touches.length;n++)if(u.touches[n].id===s.id){u.touches[n].x=s.x,u.touches[n].y=s.y,!u.touches[n].started&&(e=u.touches[n].x-u.touches[n].startX,o=u.touches[n].y-u.touches[n].startY,i<=e*e+o*o)&&(u.touches[n].started=!0,u.emit("touchstart",{type:"touchstart",touches:u.touches,touch:s}));break}s.started&&u.emit("touchmove",{type:"touchmove",touches:u.touches,touch:s})}},pointerup:function(t){var e,o=p(t,u.touches);if(o){for(var s=[],i=0;i<u.touches.length;i++)u.touches[i].id!==o.id?s.push(u.touches[i]):e=u.touches[i];u.touches=s,o.started?u.emit("touchend",{type:"touchend",touches:u.touches,touch:o}):(o.pressed||(e.pressed=!0,u.emit("tappressed",{type:"tappressed",touches:u.touches,touch:o})),u.emit("tapreleased",{type:"tapreleased",touches:u.touches,touch:o}))}},pointerupoutside:function(t){var e=p(t,u.touches);if(e){for(var o=[],s=0;s<u.touches.length;s++)u.touches[s].id!==e.id&&o.push(u.touches[s]);u.touches=o,e.started&&u.emit("touchendoutside",{type:"touchendoutside",touches:u.touches,touch:e})}}},i=0,n=Object.entries(o);i<n.length;i++){var r=n[i],c=r[0],r=r[1];document.addEventListener(c,r)}}e.TouchSurface=o},"./src/private/DefaultTicker.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultTicker=void 0;var o=(s.prototype.add=function(t){this.callbacks.push(t)},s.prototype.remove=function(t){for(var e=0;e<this.callbacks.length;)this.callbacks[e]===t?this.callbacks.splice(e,1):e++},s);function s(){var o=this;this.callbacks=[];var s=function(){for(var t=0,e=o.callbacks;t<e.length;t++)(0,e[t])();requestAnimationFrame(s)};requestAnimationFrame(s)}e.DefaultTicker=o},"./src/private/EventEmitter.ts":(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var o=(s.prototype.on=function(t,e,o){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},s.prototype.off=function(t,e){if(this.listeners[t])if(e)for(var o=0;o<this.listeners[t].length;)this.listeners[t][o]===e?this.listeners[t].splice(o,1):o++;else this.listeners[t].splice(0)},s.prototype.emit=function(t,e){if(this.listeners[t])for(var o=0,s=this.listeners[t];o<s.length;o++)(0,s[o])(e)},s);function s(){this.listeners={}}e.EventEmitter=o}},s={};function n(t){if(s[t])return s[t].exports;var e=s[t]={exports:{}};return o[t].call(e.exports,e,e.exports,n),e.exports}var u={};return(()=>{var t=u;Object.defineProperty(t,"__esModule",{value:!0}),t.TouchSurface=t.TouchState=t.TouchRegion=t.TouchGamepad=void 0;var e=n("./src/TouchGamepad.ts");Object.defineProperty(t,"TouchGamepad",{enumerable:!0,get:function(){return e.TouchGamepad}});var o=n("./src/TouchRegion.ts");Object.defineProperty(t,"TouchRegion",{enumerable:!0,get:function(){return o.TouchRegion}});var s=n("./src/TouchState.ts");Object.defineProperty(t,"TouchState",{enumerable:!0,get:function(){return s.TouchState}});var i=n("./src/TouchSurface.ts");Object.defineProperty(t,"TouchSurface",{enumerable:!0,get:function(){return i.TouchSurface}})})(),u})()});